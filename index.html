<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Matem√°ticas 4¬∫ ESO - Versi√≥n Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        .math-display { font-size: 1.1em; margin: 0.8em 0; }
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-after: always; }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script>
        // EJERCICIOS CON SOLUCIONES 100% VERIFICADAS
        const ejercicios = {
            "numeros": {
                title: "N√öMEROS Y √ÅLGEBRA",
                color: "from-blue-500 to-blue-600",
                preguntas: [
                    {
                        num: 1,
                        enunciado: "Opera:",
                        formula: "\\frac{1}{2} + \\frac{1}{4} - \\frac{1}{3} + \\frac{1}{6}",
                        apartados: [
                            { texto: "(Resultado final)", respuesta: "7/12" }
                        ]
                    },
                    {
                        num: 2,
                        enunciado: "Escribe en forma de desigualdad y representa:",
                        apartados: [
                            { texto: "a) \\((-\\infty, 3]\\)", respuesta: "x ‚â§ 3" },
                            { texto: "b) \\([1, 5)\\)", respuesta: "1 ‚â§ x < 5" },
                            { texto: "c) Intervalo com√∫n", respuesta: "[1, 3]" }
                        ]
                    },
                    {
                        num: 3,
                        enunciado: "Calcula y expresa como potencia:",
                        formula: "\\frac{2^5 \\cdot 2^3}{2^6}",
                        apartados: [
                            { texto: "(Resultado)", respuesta: "2¬≤ = 4" }
                        ]
                    },
                    {
                        num: 4,
                        enunciado: "Opera y simplifica:",
                        apartados: [
                            { texto: "a) \\(\\sqrt{16x} - \\sqrt{4x} + \\sqrt{9x}\\)", respuesta: "5‚àöx" },
                            { texto: "b) \\(2\\sqrt{3} + 3\\sqrt{3} - \\sqrt{3}\\)", respuesta: "4‚àö3" },
                            { texto: "c) \\(\\sqrt{x^2}\\) (con x>0)", respuesta: "x" },
                            { texto: "d) \\(\\sqrt{4} \\cdot \\sqrt{9}\\)", respuesta: "6" }
                        ]
                    },
                    {
                        num: 5,
                        enunciado: "Calcular:",
                        formula: "\\sqrt{36} + \\sqrt{64}",
                        apartados: [
                            { texto: "(Resultado)", respuesta: "14" }
                        ]
                    },
                    {
                        num: 6,
                        enunciado: "Expresa como potencia y como radical:",
                        apartados: [
                            { texto: "a) \\(\\dfrac{x^4}{x^2}\\)", respuesta: "x¬≤ = ‚àö(x‚Å¥)" },
                            { texto: "b) \\(\\sqrt{x} \\cdot \\sqrt{x}\\)", respuesta: "x" }
                        ]
                    },
                    {
                        num: 7,
                        enunciado: "Racionaliza:",
                        apartados: [
                            { texto: "a) \\(\\dfrac{4}{\\sqrt{2}}\\)", respuesta: "2‚àö2" },
                            { texto: "b) \\(\\dfrac{\\sqrt{6}}{\\sqrt{2}}\\)", respuesta: "‚àö3" },
                            { texto: "c) \\(\\dfrac{1}{\\sqrt{5} - 2}\\)", respuesta: "-(‚àö5 + 2)" },
                            { texto: "d) \\(\\dfrac{\\sqrt{2} + 1}{\\sqrt{2} - 1}\\)", respuesta: "3 + 2‚àö2" }
                        ]
                    },
                    {
                        num: 8,
                        enunciado: "Efect√∫a:",
                        apartados: [
                            { texto: "a) \\((2 - \\sqrt{3})(2 + \\sqrt{3})\\)", respuesta: "1" },
                            { texto: "b) \\((\\sqrt{5})^2\\)", respuesta: "5" }
                        ]
                    },
                    {
                        num: 9,
                        enunciado: "Notaci√≥n cient√≠fica:",
                        apartados: [
                            { texto: "a) \\((2 \\cdot 10^5) \\cdot (3 \\cdot 10^2)\\)", respuesta: "6 √ó 10‚Å∑" },
                            { texto: "b) \\(\\dfrac{8 \\cdot 10^6}{2 \\cdot 10^2}\\)", respuesta: "4 √ó 10‚Å¥" }
                        ]
                    }
                ]
            },
            "polinomios": {
                title: "POLINOMIOS",
                color: "from-green-500 to-green-600",
                preguntas: [
                    {
                        num: 10,
                        enunciado: "Divide \\(P(x) = x^3 + x^2 - 4x + 2\\) entre \\(Q(x) = x - 1\\) usando Ruffini.",
                        apartados: [
                            { texto: "Cociente C(x)", respuesta: "x¬≤ + 2x - 2" },
                            { texto: "Resto R", respuesta: "0" }
                        ]
                    },
                    {
                        num: 11,
                        enunciado: "Factoriza completamente:",
                        apartados: [
                            { texto: "a) \\(x^2 - 9\\)", respuesta: "(x-3)(x+3)" },
                            { texto: "b) \\(x^2 - 5x + 6\\)", respuesta: "(x-2)(x-3)" },
                            { texto: "c) \\(x^3 - 4x\\)", respuesta: "x(x-2)(x+2)" }
                        ]
                    },
                    {
                        num: 12,
                        enunciado: "Si \\(P(x) = 2x^3 - kx + 3\\) y \\(P(1) = 0\\), halla k.",
                        apartados: [
                            { texto: "Valor de k", respuesta: "5" }
                        ],
                        explicacion: "P(1) = 0 ‚Üí 2(1)¬≥ - k(1) + 3 = 0 ‚Üí 2 - k + 3 = 0 ‚Üí k = 5"
                    }
                ]
            },
            "logaritmos": {
                title: "LOGARITMOS",
                color: "from-purple-500 to-purple-600",
                preguntas: [
                    {
                        num: 13,
                        enunciado: "Si \\(\\log_2 x = 3\\), calcula:",
                        apartados: [
                            { texto: "a) Valor de x", respuesta: "8" },
                            { texto: "b) \\(\\log_2(2x)\\)", respuesta: "4" }
                        ]
                    },
                    {
                        num: 14,
                        enunciado: "Sabiendo que \\(\\log A = 2\\) y \\(\\log B = 1\\):",
                        apartados: [
                            { texto: "a) \\(\\log(A \\cdot B)\\)", respuesta: "3" },
                            { texto: "b) \\(\\log(A/B)\\)", respuesta: "1" },
                            { texto: "c) \\(\\log(A^2)\\)", respuesta: "4" }
                        ]
                    },
                    {
                        num: 15,
                        enunciado: "Calcula x:",
                        apartados: [
                            { texto: "a) \\(\\ln x = \\ln 5 + \\ln 2\\)", respuesta: "10" },
                            { texto: "b) \\(\\log x = \\log 20 - \\log 4\\)", respuesta: "5" }
                        ]
                    },
                    {
                        num: 16,
                        enunciado: "Desarrolla:",
                        apartados: [
                            { texto: "a) \\(\\log(x^2 \\cdot y)\\)", respuesta: "2log(x) + log(y)" },
                            { texto: "b) \\(\\log\\left(\\dfrac{a}{b^3}\\right)\\)", respuesta: "log(a) - 3log(b)" }
                        ]
                    },
                    {
                        num: 17,
                        enunciado: "Si \\(\\log x = 1\\), calcula:",
                        apartados: [
                            { texto: "a) \\(\\log(10x)\\)", respuesta: "2" },
                            { texto: "b) \\(\\log(x^3)\\)", respuesta: "3" },
                            { texto: "c) \\(\\log(x/10)\\)", respuesta: "0" }
                        ]
                    },
                    {
                        num: 18,
                        enunciado: "Resuelve:",
                        apartados: [
                            { texto: "a) \\(\\log x^2 = 2\\)", respuesta: "10" },
                            { texto: "b) \\(\\ln e^3 = x\\)", respuesta: "3" }
                        ]
                    },
                    {
                        num: 19,
                        enunciado: "Expresa como un logaritmo:",
                        formula: "\\log 4 + \\log 25 = \\log A",
                        apartados: [
                            { texto: "Valor de A", respuesta: "100" }
                        ]
                    },
                    {
                        num: 20,
                        enunciado: "Verdadero o Falso:",
                        apartados: [
                            { texto: "a) \\(\\log(m + n) = \\log m + \\log n\\)", respuesta: "FALSO" },
                            { texto: "b) \\(\\log(m \\cdot n) = \\log m + \\log n\\)", respuesta: "VERDADERO" },
                            { texto: "c) \\(\\log(m/n) = \\log m - \\log n\\)", respuesta: "VERDADERO" },
                            { texto: "d) \\(\\log(m^n) = n \\cdot \\log m\\)", respuesta: "VERDADERO" }
                        ]
                    }
                ]
            }
        };

        let state = {
            seccionActual: null,
            mostrarSoluciones: false,
            nombreAlumno: localStorage.getItem('nombreAlumno4ESOFinal') || '',
            respuestas: JSON.parse(localStorage.getItem('respuestas4ESOFinal') || '{}')
        };

        function guardarEstado() {
            localStorage.setItem('nombreAlumno4ESOFinal', state.nombreAlumno);
            localStorage.setItem('respuestas4ESOFinal', JSON.stringify(state.respuestas));
        }

        function setNombre() {
            const input = document.getElementById('nombreInput');
            if (input && input.value.trim()) {
                state.nombreAlumno = input.value.trim();
                guardarEstado();
                render();
            }
        }

        function toggleSoluciones() {
            state.mostrarSoluciones = !state.mostrarSoluciones;
            render();
        }

        function verSeccion(seccion) {
            state.seccionActual = seccion;
            render();
        }

        function volverInicio() {
            state.seccionActual = null;
            render();
        }

        function imprimirExamen() {
            window.print();
        }

        function reiniciarProgreso() {
            if (confirm('¬øSeguro que quieres borrar todo tu progreso?')) {
                localStorage.clear();
                state = {
                    seccionActual: null,
                    mostrarSoluciones: false,
                    nombreAlumno: '',
                    respuestas: {}
                };
                render();
            }
        }

        function guardarRespuesta(pregNum, apartadoIdx, valor) {
            const key = `${pregNum}-${apartadoIdx}`;
            state.respuestas[key] = valor;
            guardarEstado();
        }

        function render() {
            const app = document.getElementById('app');
            
            if (!state.nombreAlumno) {
                app.innerHTML = renderModalNombre();
                return;
            }

            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 p-4">
                    <div class="max-w-7xl mx-auto">
                        ${renderHeader()}
                        ${state.seccionActual ? renderSeccion() : renderMenuPrincipal()}
                    </div>
                </div>
            `;

            if (window.MathJax) {
                MathJax.typesetPromise().catch((err) => console.log(err));
            }
        }

        function renderModalNombre() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div class="text-6xl text-center mb-4">üìö</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2 text-center">¬°Bienvenido!</h2>
                        <p class="text-gray-600 mb-6 text-center">Examen de Matem√°ticas - 4¬∫ ESO</p>
                        <input type="text" id="nombreInput" placeholder="Tu nombre completo" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none mb-4"
                            onkeypress="if(event.key==='Enter') setNombre()">
                        <button onclick="setNombre()" 
                            class="w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-medium">
                            Comenzar Examen
                        </button>
                    </div>
                </div>
            `;
        }

        function renderHeader() {
            const totalPreguntas = Object.values(ejercicios).reduce((sum, sec) => sum + sec.preguntas.length, 0);
            return `
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8 mb-8 text-white no-print">
                    <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                        <div class="flex items-center gap-4">
                            <div class="text-5xl">üìê</div>
                            <div>
                                <h1 class="text-4xl font-bold mb-2">Examen Matem√°ticas 4¬∫ ESO</h1>
                                <p class="text-indigo-100 text-lg">1¬™ Evaluaci√≥n - ${totalPreguntas} preguntas</p>
                                <p class="text-indigo-200 text-sm mt-1">üë§ ${state.nombreAlumno}</p>
                            </div>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            ${state.seccionActual ? '<button onclick="volverInicio()" class="bg-white text-indigo-600 px-4 py-2 rounded-xl hover:bg-indigo-50 transition shadow-lg font-medium">üè† Inicio</button>' : ''}
                            <button onclick="toggleSoluciones()" class="bg-yellow-400 text-gray-800 px-4 py-2 rounded-xl hover:bg-yellow-300 transition shadow-lg font-medium">
                                ${state.mostrarSoluciones ? 'üëÅÔ∏è Ocultar' : '‚úÖ Ver'} Soluciones
                            </button>
                            <button onclick="imprimirExamen()" class="bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600 transition shadow-lg font-medium">
                                üñ®Ô∏è Imprimir
                            </button>
                            <button onclick="reiniciarProgreso()" class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition shadow-lg font-medium">
                                üîÑ Reiniciar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMenuPrincipal() {
            return `
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üìã Selecciona una Secci√≥n</h2>
                    <div class="grid md:grid-cols-3 gap-6">
                        ${Object.entries(ejercicios).map(([key, seccion]) => `
                            <div onclick="verSeccion('${key}')" 
                                class="bg-gradient-to-br ${seccion.color} rounded-2xl shadow-xl p-8 cursor-pointer transform transition-all duration-300 hover:scale-105 text-white">
                                <h3 class="font-bold text-2xl mb-4">${seccion.title}</h3>
                                <p class="text-white text-opacity-90 mb-4">${seccion.preguntas.length} preguntas</p>
                                <div class="flex items-center text-white font-medium">Comenzar ‚Üí</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderSeccion() {
            const seccion = ejercicios[state.seccionActual];
            return `
                <div>
                    <div class="bg-gradient-to-r ${seccion.color} rounded-2xl shadow-xl p-8 mb-8 text-white">
                        <h2 class="text-3xl font-bold">${seccion.title}</h2>
                        <p class="text-white text-opacity-90 mt-2">${seccion.preguntas.length} preguntas ¬∑ Responde en cada campo</p>
                    </div>
                    <div class="space-y-6">
                        ${seccion.preguntas.map(pregunta => renderPregunta(pregunta)).join('')}
                    </div>
                </div>
            `;
        }

        function renderPregunta(preg) {
            return `
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200 hover:border-indigo-300 transition">
                    <div class="flex items-start gap-4">
                        <span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-bold min-w-fit">#${preg.num}</span>
                        <div class="flex-1">
                            <div class="text-lg font-semibold text-gray-800 mb-3">${preg.enunciado}</div>
                            ${preg.detalle ? `<p class="text-gray-600 mb-3">${preg.detalle}</p>` : ''}
                            ${preg.formula ? `<div class="math-display bg-gray-50 p-4 rounded-lg mb-4">$$${preg.formula}$$</div>` : ''}
                            
                            <div class="space-y-3">
                                ${preg.apartados.map((ap, idx) => `
                                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                                        <div class="text-gray-700 mb-2 font-medium">${ap.texto}</div>
                                        <input type="text" 
                                            value="${state.respuestas[`${preg.num}-${idx}`] || ''}"
                                            onchange="guardarRespuesta(${preg.num}, ${idx}, this.value)"
                                            placeholder="Escribe tu respuesta aqu√≠..."
                                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg">
                                        ${state.mostrarSoluciones ? `
                                            <div class="mt-2 p-3 bg-green-50 border-2 border-green-300 rounded-lg">
                                                <span class="font-bold text-green-800">‚úì Respuesta correcta:</span>
                                                <span class="text-gray-700 ml-2 font-medium">${ap.respuesta}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${preg.explicacion && state.mostrarSoluciones ? `
                                <div class="mt-4 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                                    <span class="font-bold text-yellow-800">üí° Explicaci√≥n:</span>
                                    <p class="text-gray-700 mt-2">${preg.explicacion}</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
